<div class="orders-container">
  <h2 class="orders-title">ğŸ§¾ ÄÆ¡n hÃ ng cá»§a tÃ´i</h2>

  <div *ngIf="orders.length === 0" class="empty-order-message">
    ğŸ“­ Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o cáº£.
  </div>

  <div class="order-card" 
        *ngFor="let order of orders | paginate: { itemsPerPage: 5, currentPage: currentPage }" 
        (click)="openOrderDetail(order.orderId)">
    <div class="order-card-header">
      <div>
        <span class="order-id">#{{ order.orderId }}</span>
        <span [ngClass]="[order.status.toLowerCase()]">
          {{ getStatusText(order.status) }}
        </span>
      </div>
      <div class="order-date">{{ order.createdAt | date: 'dd/MM/yyyy' }}</div>
    </div>

    <div class="order-card-footer">
      <span class="order-total">Tá»•ng: {{ order.totalAmount | currency:'VND' }}</span>
        <div class="order-actions">
          <button class="detail-btn">Xem chi tiáº¿t</button>
          <button 
            *ngIf="canCancelOrder(order.status)" 
            class="cancel-btn"
            (click)="cancelMyOrder(order.orderId, $event)">
            âŒ Há»§y Ä‘Æ¡n
          </button>
      </div>
    </div>
  </div>
  <pagination-controls
    (pageChange)="currentPage = $event"
    [responsive]="true"
    [autoHide]="true"
    class="my-pagination">
  </pagination-controls>
</div>

<div class="order-detail-overlay" *ngIf="selectedOrderMeta">
  <div class="order-detail-popup">
    <button class="close-btn" (click)="closeOrderDetail()">âœ–</button>

    <h3 class="popup-title">Chi tiáº¿t Ä‘Æ¡n hÃ ng #{{ selectedOrderMeta.orderId }}</h3>

    <div class="popup-info">
      <p><strong>NgÃ y Ä‘áº·t:</strong> {{ selectedOrderMeta.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
      <p><strong>Tráº¡ng thÃ¡i:</strong>
        <span [ngClass]="selectedOrderMeta.status.toLowerCase()">
          {{ getStatusText(selectedOrderMeta.status) }}
        </span>
      </p>
      <p><strong>Tá»•ng tiá»n:</strong> {{ selectedOrderMeta.totalAmount | currency:'VND' }}</p>
    </div>

    <div class="order-progress-bar" *ngIf="selectedOrderMeta.status.toLowerCase() !== 'canceled' && selectedOrderMeta.status.toLowerCase() !== 'canceledbycustomer'; else canceledBlock">
      <div class="progress-track">
        <div
          *ngFor="let step of stepOrder; let i = index"
          class="progress-step"
          [ngClass]="getStepStatusClass(step)"
        >
          <div class="step-circle">
            <ng-container [ngSwitch]="step">
              <span class="step-icon" *ngSwitchCase="'processing'">ğŸ› ï¸</span>
              <span class="step-icon" *ngSwitchCase="'shipping'">ğŸšš</span>
              <span class="step-icon" *ngSwitchCase="'delivered'">ğŸ“¦</span>
              <span class="step-icon" *ngSwitchCase="'completed'">âœ…</span>
              <span class="step-icon" *ngSwitchDefault>â“</span>
            </ng-container>
          </div>
          <div class="step-label">{{ getStatusText(step) }}</div>
        </div>
      </div>
    </div>

    <ng-template #canceledBlock>
      <div class="canceled-block-container">
        {{ getStatusText(selectedOrderMeta.status) }}
      </div>
    </ng-template>

    <div class="product-table-wrapper">
      <table class="product-table">
        <thead>
          <tr>
            <th>Sáº£n pháº©m</th>
            <th>Sá»‘ lÆ°á»£ng</th>
            <th>ÄÆ¡n giÃ¡</th>
            <th>ThÃ nh tiá»n</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of selectedOrderItems">
            <td>{{ item.productName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.unitPrice | currency:'VND' }}</td>
            <td>{{ item.quantity * item.unitPrice | currency:'VND' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
